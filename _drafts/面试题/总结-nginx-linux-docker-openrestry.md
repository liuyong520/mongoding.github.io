面试-nginx
===

## **Nginx**

*   请解释什么是C10K问题或者知道什么是C10K问题吗？

*   Nginx简介，可参考《[Nginx简介](http://mp.weixin.qq.com/s?__biz=MzI1NDQ3MjQxNA==&mid=2247483994&idx=1&sn=b6591f62c7ea6b4adc5a5bf1bf4eac40&chksm=e9c5fbebdeb272fdd865a9c61a380f6b909fc988f99d00ce0aa8c3efca501644db46c40bd4f2&scene=21#wechat_redirect)》

*   正向代理和反向代理.

*   Nginx几种常见的负载均衡策略

*   Nginx服务器上的Master和Worker进程分别是什么

*   使用“反向代理服务器”的优点是什么?


**Linux基础**

*   Linux下可以在/proc目录下可以查看CPU的核心数等；cat /proc/下边会有很多系统内核信息可供显示； 

*   说一下栈的内存是怎么分配的；

*   Linux各个目录有了解过吗？/etc、/bin、/dev、/lib、/sbin这些常见的目录主要作用是什么？

*   说一下栈帧的内存是怎么分配的；

*   Linux下排查某个死循环的线程；

*   动态链接和静态链接的区别；

*   进程的内存分布；

*   如何查找一个进程打开所有的文件；

*   说一下常使用的协议及其对应的端口；

*   为什么会有内核态，保护模式你知道吗?

*   文件是怎么在磁盘上存储的？

*   有了进程为何还要线程呢，不同进程和线程他们之间有什么不同。（进程是资源管理的最小单位，线程是程序执行的最小单位。在操作系统设计上，从进程演化出线程，最主要的目的就是更好的支持SMP以及减小（进程/线程）上下文切换开销。）

*   InnoDB聚集索引B+树叶子节点和磁盘什么顺序相同;

*   文件系统，进程管理和调度，内存管理机制、虚地址保护模式；


# Ngnix原理了解吗？你们如何使用的？常用的配置参数都有哪些？
nginx由内核和模块组成，其中，内核的设计非常微小和简洁，完成的工作也非常简单，仅仅通过查找配置文件将客户端请求映射到一个location block（location是Nginx配置中的一个指令，用于URL匹配），而在这个location中所配置的每个指令将会启动不同的模块去完成相应的工作。

Nginx的模块从结构上分为核心模块、基础模块和第三方模块：

核心模块：HTTP模块、EVENT模块和MAIL模块

基础模块：HTTP Access模块、HTTP FastCGI模块、HTTP Proxy模块和HTTP Rewrite模块，

第三方模块：HTTP Upstream Request Hash模块、Notice模块和HTTP Access Key模块。

用户根据自己的需要开发的模块都属于第三方模块。正是有了这么多模块的支撑，Nginx的功能才会如此强大。
在工作方式上，Nginx分为单工作进程和多工作进程两种模式。在单工作进程模式下，除主进程外，还有一个工作进程，工作进程是单线程的；在多工作进程模式下，每个工作进程包含多个线程。Nginx默认为单工作进程模式。

Nginx在启动后，会有一个master进程和多个worker进程。

master进程

主要用来管理worker进程，包含：接收来自外界的信号，向各worker进程发送信号，监控worker进程的运行状态，当worker进程退出后(异常情况下)，会自动重新启动新的worker进程。

master进程充当整个进程组与用户的交互接口，同时对进程进行监护。它不需要处理网络事件，不负责业务的执行，只会通过管理worker进程来实现重启服务、平滑升级、更换日志文件、配置文件实时生效等功能。 

我们要控制nginx，只需要通过kill向master进程发送信号就行了。比如kill -HUP pid，则是告诉nginx，从容地重启nginx，我们一般用这个信号来重启nginx，或重新加载配置，因为是从容地重启，因此服务是不中断的。master进程在接收到HUP信号后是怎么做的呢？首先master进程在接到信号后，会先重新加载配置文件，然后再启动新的worker进程，并向所有老的worker进程发送信号，告诉他们可以光荣退休了。新的worker在启动后，就开始接收新的请求，而老的worker在收到来自master的信号后，就不再接收新的请求，并且在当前进程中的所有未处理完的请求处理完成后，再退出。当然，直接给master进程发送信号，这是比较老的操作方式，nginx在0.8版本之后，引入了一系列命令行参数，来方便我们管理。比如，./nginx -s reload，就是来重启nginx，./nginx -s stop，就是来停止nginx的运行。如何做到的呢？我们还是拿reload来说，我们看到，执行命令时，我们是启动一个新的nginx进程，而新的nginx进程在解析到reload参数后，就知道我们的目的是控制nginx来重新加载配置文件了，它会向master进程发送信号，然后接下来的动作，就和我们直接向master进程发送信号一样了。

**worker进程：**

而基本的网络事件，则是放在worker进程中来处理了。多个worker进程之间是对等的，他们同等竞争来自客户端的请求，各进程互相之间是独立的。一个请求，只可能在一个worker进程中处理，一个worker进程，不可能处理其它进程的请求。worker进程的个数是可以设置的，一般我们会设置与机器cpu核数一致，这里面的原因与nginx的进程模型以及事件处理模型是分不开的。

worker进程之间是平等的，每个进程，处理请求的机会也是一样的。当我们提供80端口的http服务时，一个连接请求过来，每个进程都有可能处理这个连接，怎么做到的呢？首先，每个worker进程都是从master进程fork过来，在master进程里面，先建立好需要listen的socket（listenfd）之后，然后再fork出多个worker进程。所有worker进程的listenfd会在新连接到来时变得可读，为保证只有一个进程处理该连接，所有worker进程在注册listenfd读事件前抢accept_mutex，抢到互斥锁的那个进程注册listenfd读事件，在读事件里调用accept接受该连接。当一个worker进程在accept这个连接之后，就开始读取请求，解析请求，处理请求，产生数据后，再返回给客户端，最后才断开连接，这样一个完整的请求就是这样的了。我们可以看到，一个请求，完全由worker进程来处理，而且只在一个worker进程中处理。worker进程之间是平等的，每个进程，处理请求的机会也是一样的。当我们提供80端口的http服务时，一个连接请求过来，每个进程都有可能处理这个连接，怎么做到的呢？首先，每个worker进程都是从master进程fork过来，在master进程里面，先建立好需要listen的socket（listenfd）之后，然后再fork出多个worker进程。所有worker进程的listenfd会在新连接到来时变得可读，为保证只有一个进程处理该连接，所有worker进程在注册listenfd读事件前抢accept_mutex，抢到互斥锁的那个进程注册listenfd读事件，在读事件里调用accept接受该连接。当一个worker进程在accept这个连接之后，就开始读取请求，解析请求，处理请求，产生数据后，再返回给客户端，最后才断开连接，这样一个完整的请求就是这样的了。我们可以看到，一个请求，完全由worker进程来处理，而且只在一个worker进程中处理。


Linux的常用命令，简单shell编写
Linux系统监控命令
9.用过反向代理吗？

2.linux下如何查看网络端口状态（netstat），如何查看内存使用情况（top）；
9.用过哪些容器？（tomcat）对比过Tomcat与其他服务器的区别吗？比如nginx？
# Ngnix的原理了解吗？

cc：# linux如何查看业务系统运行情况？具体分析指标有哪些？
7、Linux中远程传输文件有什么方式？
ack 与sed 
16、Linux了解么

17、怎么查看系统负载

18、Cpu load的参数如果为4，描述一下现在系统处于什么情况

19、Linux，查找磁盘上最大的文件的命令

20、Linux，如何查看系统日志文件
1.  linux中awk命令的使用？
2.  nginx是多线程还是单线程？
3.  linux中如何监控和查看内存、cpu情况？
4.  负载分为哪些类别和层次？你们项目中是怎么用的？


9.  linux如何实现nginx的高性能？有什么特性被应用了？直接来说，就是基于linux的网络编程
linux运维方面的知识

问：如何查看内容很大的日志，并进行滚动

答：head,tail(其实应该是用less,[http://www.cnblogs.com/nick-huang/p/4800709.html](http://www.cnblogs.com/nick-huang/p/4800709.html))

问：top里面如何看各个cpu的使用率，以及各个参数含义

答 :按c,其实是按1

0.3% us 用户空间占用CPU百分比 
1.0% sy 内核空间占用CPU百分比 
0.0% ni 用户进程空间内改变过优先级的进程占用CPU百分比 
98.7% id 空闲CPU百分比 
0.0% wa 等待输入输出的CPU时间百分比 
0.0% hi 硬中断 
0.0% si 软中断 

问：tar 如何解压/压缩，各个参数含义

答:解压记得，各个参数忘光了
没错linux的常用命令又问了一遍

查看进程的命令

查看日志的命令
linux常用命令知道哪些

6.Linux操作系统怎么进行jvm调优？都有哪些常用命令？调试线程栈的命令是什么？
8.说说linux常用的io模式
14、nginx 的负载均衡。
1、Linux 下的一些指令，$（进程 id），$?（上一条命令退出时状态），怎么查看进程，按照内存大小，CPU 占用排序等等。（大写 M 和大写 P）。

】
3、介绍下你所了解的 epoll。
7、硬链接和软连接区别。

8、DNS 解析过程。

9、kill 用法，某个进程杀不掉的原因（进入内核态，忽略 kill 信号）。

10、linux 用过的命令。

11、系统管理命令（如查看内存使用、网络情况）。

12、管道的使用。

13、grep 的使用，一定要掌握，每次都会问在文件中查找。

14、shell 脚本。

15、find 命令。

16、awk 使用。
7.Linux命令相关，问有一个文件A.txt，里面有许多行，找出其中带关键字'B'的行，并统计重复度。我问了下重复度是指啥，他说，这样吧，假设每一行都是由空格分隔开的若干字符，若整个文件中，有2行的最后一个字符都是'10'，你就输出  “10” : 2。



9 linux中文件名存储在哪里？ 改变文件名之后 MD5会不会变

只有两项数据存放在目录项中：文件名和i节点编号。不会的,只有文件内容发生改变MD5才会变化。一般对文件求MD5值只取文件内容部分，像文件名、保存目录、创建时间、修改时间、权限等等的元信息都是不进行计算的。

7 linux命令相关 问用过哪些 然后展开

9 crontab 怎么设置一个每小时、每3小时的定时任务

6\. 求一个struct的大小


4\. linux相关指令，把能记得的说一下，出了个小功能，用shell实现；


5.  Nginx、lighttpd、Apache三大主流 Web服务器的区别


1.  Linux 下 IO 模型有几种，各自的含义是什么。

2.  Linux 系统下你关注过哪些内核参数，说说你知道的

3.  Linux 下用一行命令查看文件的最后五行

4.  平时用到哪些 Linux 命令

5.  用一行命令输出正在运行的 Java 进程

10.  如何在 Windows 和 Linux 上查找哪个线程使用的 CPU 时间最长



**9\. linux中如何查看进程等命令**
1、怎么查看谁占用了80端口
6.  应用到了linux中的什么特性?
9、kill 用法，某个进程杀不掉的原因（进入内核态，忽略 kill 信号）。

7、硬链接和软连接区别。
10、linux 用过的命令。

11、系统管理命令（如查看内存使用、网络情况）。

12、管道的使用。

13、grep 的使用，一定要掌握，每次都会问在文件中查找。

14、shell 脚本。

15、find 命令。

16、awk 使用。
1、Linux 下的一些指令，$（进程 id），$?（上一条命令退出时状态），怎么查看进程，按照内存大小，CPU 占用排序等等。（大写 M 和大写 P）。
3、介绍下你所了解的 epoll。

4、数据库 sql 的了解程度。
104\. 用awk统计一个ip文件中top10
1、10w行数据，每行一个单词，统计出现次数出现最多的前100个。

（1）可以使用小根堆；

（2）在linux中实现：cat words.txt | sort | uniq -c | sort -k1,1nr | head -10

uniq -c:  显示唯一的行，并在每行行首加上本行在文件中出现的次数

sort -k1,1nr:  按照第一个字段，数值排序，且为逆序

2、一个文本文件，给你一个单词，判断单词是否出现。

grep -wq "fail" 123.txt && echo "no"||echo "yes"

新手推荐看

http://www.tldp.org/LDP/Bash-Beginners-Guide/Bash-Beginners-Guide.pdf

进阶推荐看

http://www.tldp.org/LDP/abs/abs-guide.pdf

3、两个线程如何同时监听一个端口。

多个线程可以监听同一个端口，但我们通常不这样做。

多个进程也可以同时监听一个端口，比如nginx。
linux如何查找文件

cat、vi、

find ：find <指定目录> <指定条件> <指定动作>

使用locate搜索linux系统中的文件，它比find命令快。因为它查询的是数据库(/var/lib/locatedb)，数据库包含本地所有的 文件信息。使用locate命令在根目录下搜索interfaces文件的命令为”locate interfaces“

使用”whereis“命令可以搜索linux系统中的所有可执行文件即二进制文件。使用whereis命令搜索grep二进制文件的命令为”whereis grep“。
Linux(查看指定进程)

(1) 先用pgrep [str] 命令进行模糊匹配，找到匹配该特征串的进程ID；

(2) 其次根据进程ID显示指定的进程信息，ps --pid [pid]；

(3) 因为查找出来的进程ID需要被作为参数传递给ps命令，故使用xargs命令，通过管道符号连接；

(4) 最后显示进程详细信息，需要加上-u参数。

pgrep [Java](http://lib.csdn.net/base/javase) | xargs ps -u --pid

9 crontab 怎么设置一个每小时、每3小时的定时任务
如何获取一个本地服务器上可用的端口



