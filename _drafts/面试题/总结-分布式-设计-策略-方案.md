总结-分布式-设计-策略-方案
===


**系统设计开放性题目**

*   秒杀系统设计，超卖怎么搞;

*   你们的图片时怎么存储的，对应在数据库中时如何保存图片的信息的？

*   假如成都没有一座消防站，现在问你要建立几座消防站，每个消防站要配多少名消防官兵，多少辆消防车，请你拿出一个方案；

*   基于数组实现一个循环阻塞队列；

*   常见的ipv4地址的展现形式如“168.0.0.1”，请实现ip地址和int类型的相互转换。（使用位移的方式）

*   现网某个服务部署在多台Liunx服务器上，其中一台突然出现CPU 100%的情况，而其他服务器正常，请列举可能导致这种情况发生的原因？如果您遇到这样的情况，应如何定位？内存？CPU？发布？debug？请求量？ 
**六、设计题**

*   有几台机器存储着几亿淘宝搜索日志，你只有一台2g的电脑，怎么选出搜索热度最高的十个搜索关键词;

*   如何设计算法压缩一段URL;

*   有一个页面能同时展示两个广告，现在有五个广告，设计算法使五个广告展示概率为1:2:3:4:5；

*   有25匹马，五个赛道，用最少比赛次数将25匹马排序；
*   TopN的大数据量题；

**七、大数据量问题（后边会有专题单独讨论）**

*   给定a、b两个文件，各存放50亿个url，每个url各占64字节，内存限制是4G，让你找出a、b文件共同的url？

*   海量日志数据，提取出某日访问百度次数最多的那个IP；

*   一个文本文件，大约有一万行，每行一个词，要求统计出其中最频繁出现的前10个词，请给出思想，给出时间复杂度分析。

此话题后边会有专门的文章探讨，如果有等不及的小伙伴，可以移步参考：

1、https://blog.csdn.net/v_july_v/article/details/6279498 

2、https://blog.csdn.net/v_july_v/article/details/7382693

**八、逻辑思维题**

*   有两根粗细均匀的香（烧香拜佛的香），每一根烧完都花一个小时，怎么样能够得到15min？

*   假定你有8个撞球，其中有1个球比其他的球稍重,如果只能利用天平来断定哪一个球重,要找到较重的球,要称几次?（2次）；

*   实验室里有1000个一模一样的瓶子，但是其中的一瓶有毒。可以用实验室的小白鼠来测试哪一瓶是毒药。如果小白鼠喝掉毒药的话，会在一个星期的时候死去，其他瓶子里的药水没有任何副作用。请问最少用多少只小白鼠可以在一个星期以内查出哪瓶是毒药；（答案是10只）

*   假设有一个池塘，里面有无穷多的水。现有2个空水壶，容积分别为5升和6升。问题是如何只用这2个水壶从池塘里取得3升的水；

12、应对高并发的解决办法（分布式）。

13、在项目中主要负责了哪些工作。

14、nginx 的负载均衡。

15、分布式缓存的一致性，服务器如何扩容（哈希环）。
**8、****接口如何处理重复请求？** **9、****具体处理方案是什么？**

### 分布式

*   谈谈业务中使用分布式的场景

*   Session 分布式方案

*   分布式锁的场景

*   分布是锁的实现方案

*   分布式事务

*   集群与负载均衡的算法与实现

*   说说分库与分表设计

*   分库与分表带来的分布式困境与应对之策
76\. web的http请求如何整体响应时间变长导致处理的请求数变少，该如何处理？用队列，当处理不了那么多http请求时将请求放到队列

中慢慢处理，web如何实现队列

111\. 4亿个int数，如何找出重复的数（用hash方法，建一个2的32次方个bit的hash数组，每取一个int数，可hash下2的32次方找到它在hash数组中的位置，然后将bit置1表示已存在）

112\. 4亿个url，找出其中重复的（考虑内存不够，通过hash算法，将url分配到1000个文件中，不同的文件间肯定就不会重复了，再分别找出重复的）

有1万个数组，每个数组有1000个整数，每个数组都是降序的，从中找出最大的N个数，N<1000

作者：Java高级架构
链接：https://www.jianshu.com/p/5c90d4ae0d85
來源：简书
简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。

*   百度POI中如何试下查找最近的商家功能(坐标镜像+R树)。
万亿级别的两个URL文件A和B，如何求出A和B的差集C,(Bit映射->hash分组->多文件读写效率->磁盘寻址以及应用层面对寻址的优化)

为工程师，不能仅仅满足于实现了现有的功能逻辑，还必须深入认识系统。一次请求，流经了哪些方法，执行了多少次DB操作，访问了多少次文件操作，调用多少次API操作，总共有多少次IO操作，多少CPU操作，各耗时多少 ？
https://mp.weixin.qq.com/s/wqKM4TQoaEYMwT-p3mfoVw
3.Linux下 给定一个文件，里面存放的是IP地址，统计各个IP地址出现的次数
5.对10G个数进行排序，限制内存为1G,但是这10G个数可能是整数，字符串以及中文改如何排序

用外排序+k路归并解决
27.假如有100万个玩家，需要对这100W个玩家的积分中前100名的积分，按照顺序显示在网站中，要求是实时更新的。积分可能由做的任务和获得的金钱决定。问如何对着100万个玩家前100名的积分进行实时更新？

我的想法是使用小端桶（堆？），先把前100名放进去，然后后面的那些谁的分数变化就与桶中的值比较，如果大就替换。

一个项目，理论上需要1.5G的内存就足够，但是项目上线后发现隔了几个星期，占用内存到了2.5G，这时候你会考虑是什么问题？怎么解决？

我回答会首先考虑内存泄漏，使用MemeryAnalyzer之类的工具分析检查哪里有泄漏，然后他又问用过MemeryAnalyzer吗？ 我说没用过。。

哪些方法实现线程安全。

        synchronized，reentrantlock，volatile，然后重点说了下volatile在某些情况下可以实现线程安全，然后就把面试官注意力往volatile上引，因为volatile这个专门看了一下，果然，面试官马上问了volatile。

39.volatile是实现了什么功能呢？

        然后就把自己看得乱扯了一通，比如volatile修饰汇编时会在修饰字段前加LOCK字段啊，内存屏障啥啥啥的扯了一通，就是想让面试官觉得对某些方面了解还是蛮深的。

8. 如何在一个大文本中迅速找出自己的名字（正则表达式）
8.在栈上为什么不能用变量做数组的长度，堆上可以吗？

9.问了我的项目，QQ聊天系统，怎么实现的，客户端为什么要用TCP和UDP结合，用UDP协议有什么好处，消息是怎样定义的，怎样区分不同的 消息，怎么知道使用锁的。我给他说了epoll、线程池，Reactor模式，以及自己实现的哈希表，线程之间怎样同步等
10亿条短信，找出前一万条重复率高的

（1）首先将文本导入数据库，再利用select语句某些方法得出前10条短信。（索引）但是这个时间效率很低；

（2）使用hash计算并存储次数，然后遍历一次找出top10；

![](https://img-blog.csdn.net/20170112125556194?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZDEyMzQ1Njc4YQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

![](https://img-blog.csdn.net/20170112125620757?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZDEyMzQ1Njc4YQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

5.对一万条数据排序，你认为最好的方式是什么

申请长度为一千万位的位向量bit[10000000]，所有位设置为0，顺序读取待排序文件，每读入一个数i，便将bit[i]置为1。当所有数据读入完成，便对bit做从头到尾的遍历，如果bit[i]=1，则输出i到文件，当遍历完成，文件则已排好序。本机运行耗时9秒49毫秒。

（这种方法要求数组中的数据没有重复，且都不超过最大值）
3.问了锁机制，问了浏览器如何实现的免登陆之类的功能，进而问了cookie和session相关的知识。

（1） 很多人说利用cookie保存加密后的密码和用户ID，当再次访问网站时服务器提取cookie的用户ID和密码，如果通过验证，则不需要重新输入账号和密码。

（2）1、在用户登录成功时，创建session对象，保存用户信息

2、将此session的sessionid保存到cookie中

3、同时将sessionid于session对应关系存储到应用域中，以便后面可以根据sessionid来获取到session

4、在用户关闭浏览器，重新打开浏览器访问网站时，读取用户的cookie，得到sessionid

5、根据sessionid获取到第3步存储到应用域中的session对象

6、从session中读取用户信息

4.如何保证缓冲区和数据库之间的强一致性（使用加锁）

事务，锁，

“先淘汰缓存，再修改数据库”

“先操作缓存，在写数据库成功之前，如果有读请求发生，可能导致旧数据入缓存，引发数据不一致”

写流程：

（1）先淘汰cache

（2）再写db

读流程：

（1）先读cache，如果数据命中hit则返回

（2）如果数据未命中miss则读db

（3）将db中读取出来的数据入缓存

其实不需要让全局的请求串行化，而只需要“让同一个数据的访问能串行化”就行。

在一个服务内，如何做到“让同一个数据的访问串行化”，只需要“让同一个数据的访问通过同一条DB连接执行”就行。

如何做到“让同一个数据的访问通过同一条DB连接执行”，只需要“在DB连接池层面稍微修改，按数据取连接即可”

获取DB连接的CPool.GetDBConnection()【返回任何一个可用DB连接】改为

CPool.GetDBConnection(longid)【返回id取模相关联的DB连接】

能否做到同一个数据的访问落在同一个服务上？

可以，同样是用id去区分。

由于数据库层面的读写并发，引发的数据库与缓存数据不一致的问题（本质是后发生的读请求先返回了），可能通过两个小的改动解决：

（1）修改服务Service连接池，id取模选取服务连接，能够保证同一个数据的读写都落在同一个后端服务上

（2）修改数据库DB连接池，id取模选取DB连接，能够保证同一个数据的读写在数据库层面是串行的

16.说怎么判断是一个人注册大量小号。

从判断注册页面过来的请求是否是同一IP之类的说了

有一些爬虫IP不断的访问美团网站，现在美团设定一个IP5分钟之内访问美团网站超过100次，就判定为爬虫IP，怎么设计这个程序？如果100改成10000，怎么设计？

读取log中的IP记录，并统计每个IP的访问次数，以5分钟为分隔，超过100的IP就是爬虫IP，没有超过的在5分钟的时候清零，继续统计。
3.设计一个分布式负载均衡缓冲系统，如何快速定位到是那个服务器（使用key分段、一致性hash）
高并发量大的话怎么处理热点，数据等
1、微信红包怎么实现。

2、海量数据分析。
9、一个任务分成十个任务，最后汇总计算，不能用fork/join

